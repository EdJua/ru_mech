# QMK
[QMK (Quantum Mechanical Keyboard)](https://github.com/qmk/qmk_firmware/)
Программное обеспечение с открытым исходным кодом для клавиатур. Обладает широким функционалом: гибкая работа с раскладками, слои, макросы, подсветка, работа с внешними устройствами — подключение координатных устройств PS/2, звуковые эффекты и т. п.  
Является форком [TMK](https://github.com/tmk/tmk_keyboard), развивается гораздо быстрее благодаря поддержке сообщества.
QMK работает на распространённых микроконтроллерах с архитектурой Atmel AVR и некоторых ARM.

QMK не единственный проект с исходным кодом для клавиатур, но его популярность значительно выше, чем у родительского проекта TMK и альтернативных проектов типа PS2AVR. Благодаря популярности имеет некоторые уникальные функции и считается "единственным способом" настроить работу клавиатуры ровно так, как ты хочешь. Важно понимать что ее нельзя поставить на любую клавиатуру.  
Для простоты можно сказать ~100% клавиатур которые продаются в магазинах, а не собраны самостоятельно, не имеют способа поставить туда QMK (за редким исключением, когда в клавиатуру ставится другой контроллер).  

## Функционал
Подробное описание функционала QMK см. в [оригинальной документации](https://docs.qmk.fm/#/features).

* **Слои**. Помимо традиционного переключения при удержании клавиши поддерживаются более интересные способы переключения слоёв. Например, сочетание на одной клавише переключения слоёв и обычного сканкода.
* **Макросы**. Макросы, конечно, могут быть и программными (Compose, AutoHotKey и т. п.), но аппаратные макросы работают независимо от ОС.
* **Аудио**. Ваша клавиатура может издавать звуки при включении, нажатии клавиш, переключении слоёв.
* **Auto Shift**. При нажатии клавиши удерживать её чуть дольше обычного, клавиатура отправляет нажатие с шифтом.
* **Подсветка**. Простые светодиоды, RGB-линейки, индивидуальные RGB-светодиоды под каждой клавишей.
* **Bootmagic**. Динамическое изменение настроек клавиатуры при помощи определённых комбинаций (например, замена CapsLock<->Control).
* **Динамические макросы**. Временные макросы можно создавать налету, без перепрошивки.
* **ЖК-дисплей HD44780**.
* **Key Lock**. Залипание клавиш-модификаторов.
* **Раскладка**. Физическая раскладка (layout, расположение клавиш на матрице) абстрагирована от логической раскладки (keymap, назначение сканкодов клавишам).
* **Leader Key**. Макрос можно повесить не просто на клавишу, а на определённое сочетание последовательно нажатых клавиш — аналогичный принцип используется в Compose.
* **Tap Dance**. Функция клавиши меняется в зависимости от количества последовательных нажатий.
* **Управление мышью**. Перемещение указателя с различным ускорением, кнопки, прокрутка.
* **Внешние координатные устройства**. Можно подключить трекпоинт или любое другое устройство с PS/2.
* **Терминал**. Отладочные команды через текстовый редактор.

## Поддерживаемые контроллеры
Основной архитектурой для QMK/TMK является AVR:
* ATmega32U4 ([PJRC Teensy 2.0](http://www.pjrc.com/teensy/), Pro Micro).
* AT90USB1286 ([PJRC Teensy++ 2.0](http://www.pjrc.com/teensy/))
* ATmega168P и ATmega328P поддерживаются, но из-за отсутствия аппаратного USB-стека требуют [V-USB](http://www.obdev.at/products/vusb/index.html).
* ATmega32U2

Некоторое время назад была добавлена поддержка ARM-микроконтроллеров, совместимых с ChibiOS. Наиболее распространённые и проверенные: [Blue Pill](https://wiki.stm32duino.com/index.php?title=Blue_Pill), [Black Pill](https://wiki.stm32duino.com/index.php?title=Black_Pill), [Teensy LC](https://www.pjrc.com/teensy/teensyLC.html), [Teensy 3.2](https://www.pjrc.com/store/teensy32.html). Поддержка ARM/ChibiOS развивается медленно, работает не весь функционал: Bootmagic, звук и т. д.

## Как настроить QMK
За подробностями стоит обратиться к [оригинальной документации](https://docs.qmk.fm/#/).

Обычно, процесс прошивки клавиатуры состоит из трех шагов: Подготовки и настройки файла раскладки под свои нужды и возможности клавиатуры или выбора готовой раскладки, компилирования прошивки под клавиатуру и, собственно, прошивки контроллера клавиатуры этой прошивкой.  
Но для начала есть смысл воспользоваться [Keyboard Layout Editor](http://www.keyboard-layout-editor.com) , чтобы облегчить подготовку раскладки перед прошивкой, или ознакомиться со свойствами готовых прошивок. Этот сайт позволяет очень хорошо визуализировать как будет выглядеть раскладка на клавиатуре, а авторы раскладок часто снабжают свои варианты раскладок ссылками на этот сайт где представлен их вариант.

Файл для прошивки можно создать двумя способами:

* Скомпилировать с использованием файла раскладки keymap.c, который вы пишете с нуля или правите готовый под свои нужды.
* Воспользоваться онлайн-редактором раскладки, который сам компилирует файлы прошивок на основе раскладки, созданной или импортированной пользователем.

У обоих способов есть свои плюсы и минусы. Онлайн редактор не позволяет управлять довольно большим числом функций, он не поддерживает работу с макросами, не дает настраивать низкоуровневые параметры клавиатуры. Но очень прост и быстр в работе, достаточно раскидать нужные функции по кнопкам клавиатуры, и получить готовую прошивку. Создание кеймапов вручную открывает доступ ко всем возможностям, но требует хоть и небольшого, но уверенного понимания работы QMK.

Основная проблема для пользователей проекта в том, что онлайн редактор не работает с файлами keymap.c и не способен их экспортировать. Это заставляет пользователя или делать двойную работу, или сразу использовать ручное редактирование.
